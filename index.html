<!DOCTYPE html>
<html>
<head>
	<title>Places</title>

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    
</head>
<body id="page_body">




<!-- Start of Places page -->
<div data-role="page" id="places">
  
  <div data-role="panel" id="mypanel" data-position="left" data-display="push">
      <ul data-role="listview">
          Related content:
          
      </ul>
  </div><!-- /panel -->
  
	<div data-role="header" data-position="fixed">
	  <a href="#mypanel" data-icon="bars" class="ui-btn-left panelIcon" data-position="left" data-iconpos="notext">Panel</a>
		<h1>Places</h1>
		<a href="#" data-icon="refresh" onclick='getLocation()' class="ui-btn-right" data-iconpos="notext">Refresh</a>
	    
	</div><!-- /header -->

	<div data-role="content">
		
		<!-- <div id="map_canvas" style="width:250px;height:250px"></div> -->	
		
		<ul id="resultsList" data-role="listview" data-filter="true" data-filter-reveal="false" data-filter-placeholder="Favorite a place">			

		</ul>
		
	</div><!-- /content -->
	
	<div data-role="footer" data-id="places" data-position="fixed" class="nav-glyphish-example">
		<div data-role="navbar" class="nav-glyphish-example">
			<ul>
				<li><a href="#places" class="ui-btn-active ui-state-persist" id="beer" data-icon="custom">Places</a></li>
				<li><a href="#favorites-all" data-transition="none" id="beer" data-icon="custom">Favorites</a></li>
			</ul>
		</div><!-- /navbar -->
	</div><!-- /footer -->
	
</div><!-- /page -->

<script type="text/javascript" charset="utf-8">

  $('#panelPlaces').click(function() {
      $( "#mypanel" ).panel( "close" );
  });
  
  $('#panelFavorites').click(function() {
      $( "#mypanel" ).panel( "close" );
  });

</script>

<!-- Start of Favorites page -->
<div data-role="page" id="favorites">
  
  <div data-role="panel" id="mypanel" data-position="left" data-display="push">
      Related content...
  </div><!-- /panel -->

	<div data-role="header" data-position="fixed">
	  <a href="#mypanel" data-icon="bars" class="ui-btn-left" data-position="left" data-iconpos="notext">Panel</a>
		<h1>Favorites</h1>
	    <div data-role="navbar">
	    </div><!-- /navbar -->
	</div><!-- /header -->
	
	<div data-role="content">
	  
	  <p>
	    <center>
  	  <div data-role="controlgroup" data-type="horizontal" data-mini="true">
        <a href="#" data-role="button" class="ui-btn-active ui-state-persist">Now</a>
        <a href="#favorites-all" data-role="button">All</a>
      </div>
      </center>
    </p>
		
		<p>
		  <ul data-role="listview" data-filter="true" data-filter-reveal="false" data-filter-placeholder="Search my favorites right now..."></ul>
		</p>
		
	</div><!-- /content -->
	
	<div data-role="footer" data-id="favorites" data-position="fixed" class="nav-glyphish-example">
		<div data-role="navbar" class="nav-glyphish-example">
			<ul>
				<li><a href="#places" data-transition="none" id="beer" data-icon="custom">Places</a></li>
				<li><a href="#favorites" class="ui-btn-active ui-state-persist" id="beer" data-icon="custom">Favorites</a></li>
			</ul>
		</div><!-- /navbar -->
	</div><!-- /footer -->

</div><!-- /page -->

<!-- Start of Favorites ALL page -->
<div data-role="page" id="favorites-all">

  <div data-role="panel" id="mypanel" data-position="left" data-display="push">
      Related content...
  </div><!-- /panel -->

	<div data-role="header" data-position="fixed">
	  <a href="#mypanel" data-icon="bars" class="ui-btn-left" data-position="left" data-iconpos="notext">Panel</a>
		<h1>Favorites</h1>
	</div><!-- /header -->
	
	<div data-role="content">
	  
    <!-- <p>
      <center>
        <div data-role="controlgroup" data-type="horizontal" data-mini="true">
        <a href="#favorites" data-role="button">Now</a>
        <a onClick="favesAll();" href="#" data-role="button" class="ui-btn-active ui-state-persist">All</a>
        </div>
      </center>
    </p> -->
		
		<ul id="all-my-favorites" data-role="listview" data-filter="true" data-filter-reveal="false" data-filter-placeholder="Search my favorites..."></ul>
		
	</div><!-- /content -->
	
	<div data-role="footer" data-id="favorites" data-position="fixed" class="nav-glyphish-example">
		<div data-role="navbar" class="nav-glyphish-example">
			<ul>
				<li><a href="#places" data-transition="none" id="beer" data-icon="custom">Places</a></li>
				<li><a href="#favorites-all" class="ui-btn-active ui-state-persist" id="beer" data-icon="custom">Favorites</a></li>
			</ul>
		</div><!-- /navbar -->
	</div><!-- /footer -->

</div><!-- /page -->



<!-- favorited -->
<div data-role="page" id="favorited">
    <div data-role="header">
      <a data-role="button" data-rel="back" data-icon="back">Back</a>
         <h3 id="places-name">Name Goes Here</h3>
      <a href="#" data-icon="delete" class="" onClick="deleteFave();">Delete</a>
    </div>
    
    <div data-role="content">
    
        <ul data-role="listview">
          <li>You like <b><span id="FavoritedplaceName"></span></b></li>
          <li>on <b><span id="FavoriteddayofWeek"></span>s</b></li>
          <li>around <b><span id="FavoritedtimeofDay"></span> o'clock</b></li>
          <li>located at <b><span id="FavoritedlocationName"></span></b></li>
        </ul>
      	
    </div>
</div>
    <!-- end #favorited -->

<!-- display -->
<div data-role="page" id="display">
    <div data-role="header">
      <a data-role="button" data-rel="back" data-icon="back">Back</a>
         <h3 id="places-name">Name Goes Here</h3>
      <a href="#" data-icon="check" onClick="saveButton();" class="" id="Savebtn">Save</a>
    </div>

	<script type="text/javascript" charset="utf-8">

	loadListFavorites();
	setFavoriteList();
	
	function deleteFave() {
	  alert("deleted!");
	  var itemKey = $("#places-name").html();
	  localStorage.removeItem('places'+ itemKey);
	  $.mobile.changePage( "#favorites-all", { reverse: true, transition: "slide"} );
	  //refresh the items
	  loadListFavorites();
	  $('#all-my-favorites').listview('refresh');
	  setFavoriteList();
	  //need to reset the placeIDnumber i think...
	}

	function loadListFavorites() {
	    $('#all-my-favorites').empty();
		  for (var i = 0; i < localStorage.length; i++){         
	      	var result = JSON.parse( localStorage.getItem(localStorage.key(i)));          
	      	$('ul#all-my-favorites').append('<li><a href="#favorited" data-transition="slide">' + result.name +'</a></li>');
	    }
	}

  var placeIDnumber = 0;
      
  function saveButton() {
      alert("Saved to your favorites!");	

  	  placeIDnumber = placeIDnumber + 1;
  	  var places = {};
  	  places.id = placeIDnumber;
  	  places.name = $("#display h3#places-name").html();
  	  places.location = $('#placeLocation').html();
  	  places.timeOfDay = $('#timeofday').html();
  	  places.dayofWeek = $('#dayofweek').html();
      localStorage.setItem( 'places' + $("#display h3").html(), JSON.stringify(places) );	
  
      $('#all-my-favorites').empty(); 

      for (var i = 0; i < localStorage.length; i++){         
        var result = JSON.parse( localStorage.getItem(localStorage.key(i)));          
        $('ul#all-my-favorites').append('<li><a href="#favorited" data-transition="slide">' + result.name +'</a></li>');
      }
    
      //if Saved, change the Save button to activated
      //$("#Savebtn").addClass("ui-btn-active");
    
      //doesnt work the first time you save, but works the 2nd time...  has noName the first time you save
      setFavoriteList();
  }  
  
  // Something is up with this one.  If i comment it out, it works fine  Maybe order of operations?
  //setFavoriteList();
  	
	function setFavoriteList() {
	  var newcurrentItem = 0;
    
    $('#all-my-favorites li').click(function() {
        placetext = $(this).index();
    });	  
    
    $('#favorited').on('pagebeforeshow', function() {
       var favoritedName = JSON.parse( localStorage.getItem(localStorage.key(placetext)));
       $(this).find('[data-role=header] .ui-title').text(favoritedName.name);
       $('#FavoritedplaceName').text(favoritedName.name);
       $('#FavoritedlocationName').text(favoritedName.location);
       $('#FavoritedtimeofDay').text(favoritedName.timeOfDay);
       $('#FavoriteddayofWeek').text(favoritedName.dayofWeek);
    });
    
    //refresh the listview
    $('#all-my-favorites').listview('refresh');
    
	}
		
	</script>	

    <div data-role="content"> 
      
      <ul data-role="listview">
        <li>You like <b><span id="nameofPlace"></span></b></li>
        <li>on <b><span id="dayofweek"></span>s</b></li>
        <li>around <b><span id="timeofday"></span> o'clock</b></li>
        <li>located at <b><span id="placeLocation"></span></b></li>
      </ul>      
        
    </div>
    <!-- end #display -->

    <script type="text/javascript" charset="utf-8">

      var date = new Date();
      var weekday=new Array(7);
			weekday[0]="Sunday";
			weekday[1]="Monday";
			weekday[2]="Tuesday";
			weekday[3]="Wednesday";
			weekday[4]="Thursday";
			weekday[5]="Friday";
			weekday[6]="Saturday";
			var day = weekday[date.getDay()];
			$("#dayofweek").html(day);

			var hour = date.getHours();
			if (hour > 12) {
          hour -= 12;
      } else if (hour === 0) {
         hour = 12;
      }
			$("#timeofday").html(hour);
			
    </script>
    
</div>


<script>

  //start searching for a place
	getLocation();
	
	function getLocation()
	  {
	  if (navigator.geolocation)
	    {
	    navigator.geolocation.getCurrentPosition(showPosition,showError);
	    }
	  else{x.innerHTML='Geolocation is not supported by this browser.';}
	  }


	function showPosition(position)
	  {
	  var latlon=position.coords.latitude+','+position.coords.longitude;
	  var latitude = position.coords.latitude;
	  var longitude = position.coords.longitude;

	  var img_url='http://maps.googleapis.com/maps/api/staticmap?center='
	  +latlon+'&zoom=14&size=400x300&sensor=false';
			
	  // document.getElementById('map_canvas').innerHTML='<img src=http://maps.googleapis.com/maps/api/staticmap?center='+latlon+'&zoom=14&size=400x300&sensor=false>';

	  //refresh to a blank list    
    var currentItem = 0;	  
	
$.getJSON('https://api.foursquare.com/v2/venues/search?ll='+latitude+','+longitude+'&query=bar&limit=10&client_id=2POUFAUU4ZBJ2MTDOY3S2YHR2NIT52FYW0LUTPHBMNTJFJNQ&client_secret=YFDZI1YWV3ZI5S5SPM2DZJEQIEBPIDJ5XFZBWTIKIQZVQNYM&v=20120101',
	    function(data) {
	       $.each(data.response.venues, function(i,venues){
	         console.log(data.response.venues);
				   $('#resultsList').append('<li><a href="#display" data-transition="slide">' + venues.name + '</a></li>');
	       });
	       $('#resultsList').listview('refresh');
	       $('#resultsList li').click(function() {
             currentItem = $(this).index();
         });	  
         $('#display').on('pagebeforeshow', function() {
           $(this).find('[data-role=header] .ui-title').text(data.response.venues[currentItem].name);
           $('#nameofPlace').text(data.response.venues[currentItem].name);
           $('#placeLocation').text(data.response.venues[currentItem].location.address);
         });     
		});
		
		
	  } //end showPosition()


	function showError(error)
	  {
	  switch(error.code) 
	    {
	    case error.PERMISSION_DENIED:
	      x.innerHTML='User denied the request for Geolocation.'
	      break;
	    case error.POSITION_UNAVAILABLE:
	      x.innerHTML='Location information is unavailable.'
	      break;
	    case error.TIMEOUT:
	      x.innerHTML='The request to get user location timed out.'
	      break;
	    case error.UNKNOWN_ERROR:
	      x.innerHTML='An unknown error occurred.'
	      break;
	    }
	  }


    
</script>


</body>
</html>