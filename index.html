<!DOCTYPE html>
<html>
<head>
	<title>Places</title>

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    
</head>
<body id="page_body">

<!-- Start of Places page -->
<div data-role="page" id="places">

	<div data-role="header" data-position="fixed">
		<h1>Places</h1>
		<a href="#" data-icon="refresh" onclick='getLocation()' class="ui-btn-right">Refresh</a>
	    
	</div><!-- /header -->

	<div data-role="content">
		
		<div id="map_canvas" style="width:250px;height:250px"></div>	
		
		<ul id="resultsList" data-role="listview" data-filter="true" data-filter-reveal="false" data-filter-placeholder="Choose a favorite place">			

		</ul>
		
	</div><!-- /content -->

	<div data-role="footer" data-id="places" data-position="fixed" class="nav-glyphish-example">
		<div data-role="navbar" class="nav-glyphish-example">
			<ul>
				<li><a href="#places" class="ui-btn-active ui-state-persist" id="beer" data-icon="custom">Places</a></li>
				<li><a href="#favorites" data-transition="none" id="beer" data-icon="custom">My favorites</a></li>
			</ul>
		</div><!-- /navbar -->
	</div><!-- /footer -->
	
</div><!-- /page -->

<!-- Start of Favorites page -->
<div data-role="page" id="favorites">

	<div data-role="header" data-position="fixed">
		<h1>My favorites</h1>
	    <div data-role="navbar">
	        <ul>
	            <li><a href="#" class="ui-btn-active ui-state-persist">Now</a></li>
	            <li><a href="#favorites-all" data-transition="none">All</a></li>
	        </ul>
	    </div><!-- /navbar -->
	</div><!-- /header -->

	<div data-role="content">
		
		<ul data-role="listview">
			<div id="map_canvas" style="width:250px;height:250px"><iframe width="425" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://maps.google.com/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=&amp;q=230+judah+st&amp;aq=&amp;sll=37.7577,-122.4376&amp;sspn=0.163946,0.363579&amp;ie=UTF8&amp;hq=&amp;hnear=230+Judah+St,+San+Francisco,+California+94122&amp;ll=37.762489,-122.464668&amp;spn=0.010246,0.022724&amp;t=m&amp;z=14&amp;iwloc=A&amp;output=embed"></iframe></div>
		    <li><a href="#judah" data-transition="slide">Judah</a></li>
		    <li><a href="#">Audi</a></li>
		</ul>
		
	</div><!-- /content -->

	<div data-role="footer" data-id="favorites" data-position="fixed" class="nav-glyphish-example">
		<div data-role="navbar" class="nav-glyphish-example">
			<ul>
				<li><a href="#places" data-transition="none" id="beer" data-icon="custom">Places</a></li>
				<li><a href="#favorites" class="ui-btn-active ui-state-persist" id="beer" data-icon="custom">My favorites</a></li>
			</ul>
		</div><!-- /navbar -->
	</div><!-- /footer -->
</div><!-- /page -->

<!-- Start of Favorites ALL page -->
<div data-role="page" id="favorites-all">

	<div data-role="header" data-position="fixed">
		<h1>My favorites</h1>
	    <div data-role="navbar">
	        <ul>
	            <li><a href="#favorites" data-transition="none">Now</a></li>
	            <li><a onClick="favesAll();" href="#" class="ui-btn-active ui-state-persist">All</a></li>
	        </ul>
	    </div><!-- /navbar -->
	</div><!-- /header -->

	<div data-role="content">
		
		<ul id="all-my-favorites" data-role="listview" data-filter="true" data-filter-reveal="false" data-filter-placeholder="Search all my favorites...">			

		</ul>
		
	</div><!-- /content -->

	<div data-role="footer" data-id="favorites" data-position="fixed" class="nav-glyphish-example">
		<div data-role="navbar" class="nav-glyphish-example">
			<ul>
				<li><a href="#places" data-transition="none" id="beer" data-icon="custom">Places</a></li>
				<li><a href="#favorites" class="ui-btn-active ui-state-persist" id="beer" data-icon="custom">My favorites</a></li>
			</ul>
		</div><!-- /navbar -->
	</div><!-- /footer -->
</div><!-- /page -->


<!-- display -->
<div data-role="page" id="display">
    <div data-role="header">
      <a data-role="button" data-rel="back" data-icon="back">Back</a>
         <h3 id="places-name">Name Goes Here</h3>
      <a href="#" data-icon="check" class="" id="save-btn">Save</a>
    </div>

	<script type="text/javascript" charset="utf-8">

		$("#save-btn").on( "click", function( event ){
			alert("Saved to your favorites!");	
			
			var places = {};
			places.id = 1;
			places.name = $("#display h3#places-name").html();
			
      localStorage.setItem( 'places' + $("#display h3").html(), JSON.stringify(places) );	
    
      $('#all-my-favorites').empty(); 
      for (var i = 0; i < localStorage.length; i++){         
          var result = JSON.parse( localStorage.getItem(localStorage.key(i)));          
          $('ul#all-my-favorites').append('<li><a href="#" data-transition="slide">' + result.name +'</a></li>');
      }
      //refresh the listview
      $('#all-my-favorites').listview('refresh');
      
            
		});

		function favesAll(){
		    //alert("test");
		    

		    
		};

		
		
	</script>

    <div data-role="content">
      
        <div class="ui-grid-a">
      	    <div class="ui-block-a">
      			<div style="height:100px">
      				<p><span class="locationName">Judah Bar</span><br/><div id="definition">Location goes here</div> <span class="locationPrice">$</span></p>
      			</div>
      		</div>
      	    <div class="ui-block-b">
      			<div style="height:100px">
      				<p>Your favorite on<br/>
      					<span id="dayofweek"></span>s around 
      					<span id="timeofday"></span>
      				</p>
      			</div>
      		</div>
      	</div><!-- /grid-a -->

      	<div id="map_canvas" style="width:250px;height:250px"><iframe width="425" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://maps.google.com/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=&amp;q=230+judah+st&amp;aq=&amp;sll=37.7577,-122.4376&amp;sspn=0.163946,0.363579&amp;ie=UTF8&amp;hq=&amp;hnear=230+Judah+St,+San+Francisco,+California+94122&amp;ll=37.762489,-122.464668&amp;spn=0.010246,0.022724&amp;t=m&amp;z=14&amp;iwloc=A&amp;output=embed"></iframe></div>
      
      
        
    </div>
    
    <script type="text/javascript" charset="utf-8">

      var date = new Date();
      var weekday=new Array(7);
			weekday[0]="Sunday";
			weekday[1]="Monday";
			weekday[2]="Tuesday";
			weekday[3]="Wednesday";
			weekday[4]="Thursday";
			weekday[5]="Friday";
			weekday[6]="Saturday";
			var day = weekday[date.getDay()];
			$("#dayofweek").html(day);

			var hour = date.getHours();
			$("#timeofday").html(hour);
			
    </script>
    
</div>


<script>

  //start searching for a place
	getLocation();
	
	function getLocation()
	  {
	  if (navigator.geolocation)
	    {
	    navigator.geolocation.getCurrentPosition(showPosition,showError);
	    }
	  else{x.innerHTML='Geolocation is not supported by this browser.';}
	  }


	function showPosition(position)
	  {
	  var latlon=position.coords.latitude+','+position.coords.longitude;
	  var latitude = position.coords.latitude;
	  var longitude = position.coords.longitude;

	  var img_url='http://maps.googleapis.com/maps/api/staticmap?center='
	  +latlon+'&zoom=14&size=400x300&sensor=false';
			
	  document.getElementById('map_canvas').innerHTML='<img src=http://maps.googleapis.com/maps/api/staticmap?center='+latlon+'&zoom=14&size=400x300&sensor=false>';

	  //refresh to a blank list    
    var currentItem = 0;	  
	
$.getJSON('https://api.foursquare.com/v2/venues/search?ll='+latitude+','+longitude+'&query=bar&limit=10&client_id=2POUFAUU4ZBJ2MTDOY3S2YHR2NIT52FYW0LUTPHBMNTJFJNQ&client_secret=YFDZI1YWV3ZI5S5SPM2DZJEQIEBPIDJ5XFZBWTIKIQZVQNYM&v=20120101',
	    function(data) {
	       $.each(data.response.venues, function(i,venues){
	         console.log(data.response.venues);
				   $('#resultsList').append('<li><a href="#display" data-transition="slide">' + venues.name + '</a></li>')
	       });
	       $('#resultsList').listview('refresh');
	       $('#resultsList li').click(function() {
             currentItem = $(this).index();
         });	  
         $('#display').on('pagebeforeshow', function() {
               $(this).find('[data-role=header] .ui-title').text(data.response.venues[currentItem].name);
               $('#definition').text(data.response.venues[currentItem].location.address);
          });     
		});
		
		
	  } //end showPosition()


	function showError(error)
	  {
	  switch(error.code) 
	    {
	    case error.PERMISSION_DENIED:
	      x.innerHTML='User denied the request for Geolocation.'
	      break;
	    case error.POSITION_UNAVAILABLE:
	      x.innerHTML='Location information is unavailable.'
	      break;
	    case error.TIMEOUT:
	      x.innerHTML='The request to get user location timed out.'
	      break;
	    case error.UNKNOWN_ERROR:
	      x.innerHTML='An unknown error occurred.'
	      break;
	    }
	  }


    
</script>


</body>
</html>